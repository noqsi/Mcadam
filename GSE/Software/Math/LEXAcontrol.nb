(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     32370,        765]
NotebookOptionsPosition[     29743,        727]
NotebookOutlinePosition[     30136,        743]
CellTagsIndexPosition[     30093,        740]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"enterRegister", "[", 
    RowBox[{"hex_", ",", "rw_", ",", "bits_", ",", "name_"}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"regHex", "[", "name", "]"}], "=", "hex"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"regRW", "[", "name", "]"}], "=", "rw"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"regbits", "[", "name", "]"}], "=", "bits"}], ";"}], 
    "\[IndentingNewLine]", ")"}]}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.899976663201136*^9, 3.899976702286409*^9}, {
  3.899976735351595*^9, 3.8999767944967203`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"e4b641ad-6640-4600-95ff-470fc8616eec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"regHex", "=", 
   RowBox[{"<|", "|>"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"regRW", "=", 
   RowBox[{"<|", "|>"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"regBits", "=", 
   RowBox[{"<|", "|>"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"log", "=", 
   RowBox[{"<|", "|>"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<00\>\"", ",", "\"\<rw\>\"", ",", "0", ",", "\"\<null\>\""}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<01\>\"", ",", "\"\<rw\>\"", ",", "1", ",", "\"\<MODE\>\""}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{
   "\"\<02\>\"", ",", "\"\<rw\>\"", ",", "1", ",", "\"\<HV_CTRL\>\""}], "]"}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{
   "\"\<03\>\"", ",", "\"\<rw\>\"", ",", "16", ",", "\"\<DAC_DATA\>\""}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<04\>\"", ",", "\"\<rw\>\"", ",", "8", ",", "\"\<HSEC\>\""}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{
   "\"\<10\>\"", ",", "\"\<rw\>\"", ",", "3", ",", 
    "\"\<FPM0_FAST_ADC_GAIN\>\""}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{
   "\"\<11\>\"", ",", "\"\<rw\>\"", ",", "3", ",", 
    "\"\<FPM0_SLOW_ADC_GAIN\>\""}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{
   "\"\<12\>\"", ",", "\"\<rw\>\"", ",", "16", ",", 
    "\"\<FPM0_FAST_ADC_OFFSET\>\""}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{
   "\"\<13\>\"", ",", "\"\<rw\>\"", ",", "16", ",", 
    "\"\<FPM0_SLOW_ADC_OFFSET\>\""}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{
   "\"\<20\>\"", ",", "\"\<rw\>\"", ",", "3", ",", 
    "\"\<FPM1_FAST_ADC_GAIN\>\""}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{
   "\"\<21\>\"", ",", "\"\<rw\>\"", ",", "3", ",", 
    "\"\<FPM1_SLOW_ADC_GAIN\>\""}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{
   "\"\<22\>\"", ",", "\"\<rw\>\"", ",", "16", ",", 
    "\"\<FPM1_FAST_ADC_OFFSET\>\""}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{
   "\"\<23\>\"", ",", "\"\<rw\>\"", ",", "16", ",", 
    "\"\<FPM1_SLOW_ADC_OFFSET\>\""}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<30\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<FLLD-0\>\""}],
    "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<31\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<SLLD-0\>\""}],
    "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<32\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<TEMP-0\>\""}],
    "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<33\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<HOT-0\>\""}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<34\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<HVHK-0\>\""}],
    "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<35\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<TIS-0\>\""}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<36\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<TVS-0\>\""}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<38\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<FLLD-1\>\""}],
    "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<39\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<SLLD-1\>\""}],
    "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<3A\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<TEMP-1\>\""}],
    "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<3B\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<HOT-1\>\""}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<3C\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<HVHK-1\>\""}],
    "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<3D\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<TIS-1\>\""}], 
   "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"enterRegister", "[", 
   RowBox[{"\"\<3E\>\"", ",", "\"\<r\>\"", ",", "16", ",", "\"\<TVS-1\>\""}], 
   "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.899975713324568*^9, 3.89997573222088*^9}, {
  3.8999770644175377`*^9, 3.899977079494108*^9}, {3.899987684087927*^9, 
  3.899987832997367*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"e9f1608d-78bb-41c4-8ab6-01451057e5f5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FPGAregs", "=", 
   RowBox[{
    RowBox[{"Select", "[", 
     RowBox[{
      RowBox[{"Normal", "[", "regRW", "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "\"\<rw\>\""}], "&"}]}], 
     "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"HKchannels", "=", 
   RowBox[{
    RowBox[{"Select", "[", 
     RowBox[{
      RowBox[{"Normal", "[", "regRW", "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "\"\<r\>\""}], "&"}]}], 
     "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.900153998302825*^9, 3.900154073464904*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"db9d2bf5-dafd-4e2c-b724-4c4cac234a54"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"startGSE", "[", "]"}], ":=", 
   RowBox[{"gse", "=", 
    RowBox[{"StartProcess", "[", "\"\<lexagse\>\"", "]"}]}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.899987120710608*^9, 3.8999871466379747`*^9}, 
   3.899988183665386*^9, {3.900063765673974*^9, 3.900063767129033*^9}, {
   3.900173929490411*^9, 3.90017394979536*^9}},
 CellLabel->"In[90]:=",ExpressionUUID->"27f605d0-a74c-4b0e-9f16-3c6d6642680b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"stopGSE", "[", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"KillProcess", "[", "gse", "]"}], ";", 
    RowBox[{"gse", "=", "Null"}]}], ")"}]}]], "Input",
 CellChangeTimes->{{3.900063956612722*^9, 3.900063982281643*^9}, {
   3.900173878659745*^9, 3.900173879297826*^9}, 3.900174358345893*^9, {
   3.900174453574587*^9, 3.900174454278591*^9}, {3.900174587377037*^9, 
   3.9001746107321978`*^9}},
 CellLabel->"In[91]:=",ExpressionUUID->"92843710-6778-4385-83ad-9e22a8d6cbb6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rawCommand", "[", "cmd_String", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WriteLine", "[", 
     RowBox[{"gse", ",", "cmd"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Pause", "[", "0.1", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"processResponses", "[", 
     RowBox[{"ReadString", "[", 
      RowBox[{"gse", ",", "EndOfBuffer"}], "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{{3.899978346483901*^9, 3.89997836750146*^9}, {
   3.899978461787909*^9, 3.899978479320402*^9}, {3.899980003187747*^9, 
   3.899980004588005*^9}, {3.8999856226103897`*^9, 3.899985684231686*^9}, {
   3.8999857163601713`*^9, 3.899985744414706*^9}, {3.899986941033924*^9, 
   3.899987016111499*^9}, 3.899987864440094*^9},
 CellLabel->"In[37]:=",ExpressionUUID->"4bd36f92-1ea9-41c5-8e23-cc7d5d06af98"],

Cell[BoxData[
 RowBox[{
  RowBox[{"processResponses", "[", "s_", "]"}], ":=", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"r", "=", 
      RowBox[{"ImportString", "[", 
       RowBox[{"s", ",", "\"\<TSV\>\""}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"toLog", "[", "s", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Scan", "[", 
      RowBox[{"response", ",", "r"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.899988144019072*^9, 3.899988160373415*^9}, {
  3.9000844447509117`*^9, 3.900084458680244*^9}, {3.900084853621228*^9, 
  3.9000848685015097`*^9}, {3.900084909802763*^9, 3.900085022082233*^9}, {
  3.9000874834163923`*^9, 3.900087548295467*^9}, {3.900087763725947*^9, 
  3.9000878017524023`*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"ec58ca09-b59f-4f18-9942-ba2132239018"],

Cell[BoxData[
 RowBox[{
  RowBox[{"response", "[", 
   RowBox[{"{", 
    RowBox[{"t_", ",", "\"\<current_adr\>\"", ",", "wa_", ",", "ra_"}], "}"}],
    "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"shadowWriteAddr", "=", "wa"}], ";", "\[IndentingNewLine]", 
    RowBox[{"shadowReadAddr", "=", "ra"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}]], "Input",
 CellChangeTimes->{{3.900087149400058*^9, 3.9000872238116007`*^9}, {
   3.9000873151116056`*^9, 3.900087425118657*^9}, 3.900087607648694*^9, {
   3.9000882088139267`*^9, 3.900088215028908*^9}, {3.900097073250238*^9, 
   3.900097093146566*^9}, {3.900154851220978*^9, 3.900154864181445*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"ded5d7ff-0ebf-459e-ac76-79bb6fab9e5b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"response", "[", 
   RowBox[{"{", 
    RowBox[{"t_", ",", "\"\<data_out\>\"", ",", "d_"}], "}"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lastDataOut", "=", "d"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}]], "Input",
 CellChangeTimes->{{3.900087149400058*^9, 3.9000872238116007`*^9}, {
   3.9000873151116056`*^9, 3.900087425118657*^9}, 3.900087607648694*^9, {
   3.9000882088139267`*^9, 3.900088215028908*^9}, {3.9000932916226397`*^9, 
   3.900093354611964*^9}, {3.900097040629311*^9, 3.900097052108906*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"7ef29023-2022-4af5-8fbe-e73bca52064f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"response", "[", 
   RowBox[{"{", 
    RowBox[{"t_", ",", "\"\<data_in\>\"", ",", "d_"}], "}"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lastDataIn", "=", "d"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}]], "Input",
 CellChangeTimes->{{3.900087149400058*^9, 3.9000872238116007`*^9}, {
   3.9000873151116056`*^9, 3.900087425118657*^9}, 3.900087607648694*^9, {
   3.9000882088139267`*^9, 3.900088215028908*^9}, {3.9000932916226397`*^9, 
   3.900093400018508*^9}, {3.900097058728261*^9, 3.900097066799026*^9}},
 CellLabel->"In[41]:=",ExpressionUUID->"e665a488-f3ac-4df9-bda9-3bfc1e3b9f25"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rawXadr", "[", 
   RowBox[{"w_String", ",", "r_String"}], "]"}], ":=", 
  RowBox[{"rawCommand", "[", 
   RowBox[{"\"\<xadr \>\"", "<>", "w", "<>", "\"\< \>\"", "<>", "r"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rawXdata", "[", "d_Integer", "]"}], ":=", 
  RowBox[{"rawCommand", "[", 
   RowBox[{"\"\<xdata \>\"", "<>", 
    RowBox[{"ToString", "[", "d", "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.8999883475382757`*^9, 3.899988452345017*^9}, {
  3.899996632816135*^9, 3.899996670440672*^9}, {3.899996870140111*^9, 
  3.899996917459208*^9}},
 CellLabel->"In[42]:=",ExpressionUUID->"fd216a1a-e174-4db8-a7ab-216f0847904e"],

Cell["\<\
Usually, we\[CloseCurlyQuote]ll either read or write data, but not plan both \
at once. \
\>", "Text",
 CellChangeTimes->{{3.9000024477961817`*^9, 3.900002502023959*^9}, {
  3.900004697844273*^9, 
  3.900004699018034*^9}},ExpressionUUID->"1e40a1cf-a670-471f-8511-\
e7a21682c41e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"readAdr", "[", "adr_String", "]"}], ":=", 
  RowBox[{"rawXadr", "[", 
   RowBox[{"\"\<00\>\"", ",", 
    RowBox[{"regHex", "[", "adr", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"writeAdr", "[", "adr_String", "]"}], ":=", 
  RowBox[{"rawXadr", "[", 
   RowBox[{
    RowBox[{"regHex", "[", "adr", "]"}], ",", "\"\<00\>\""}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.900002254546421*^9, 3.9000024055490294`*^9}},
 CellLabel->"In[44]:=",ExpressionUUID->"2e630c41-c96b-48d4-9503-3ef8d2e5bdec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dacNumbers", "=", 
   RowBox[{"<|", "|>"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dacNumbers", "[", "\"\<FLLD-0\>\"", "]"}], "=", "0"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dacNumbers", "[", "\"\<HVDAC-0\>\"", "]"}], "=", "1"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dacNumbers", "[", "\"\<SLLD-0\>\"", "]"}], "=", "2"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dacNumbers", "[", "\"\<TDAC-0\>\"", "]"}], "=", "3"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dacNumbers", "[", "\"\<FLLD-1\>\"", "]"}], "=", "4"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dacNumbers", "[", "\"\<HVDAC-1\>\"", "]"}], "=", "5"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dacNumbers", "[", "\"\<SLLD-1\>\"", "]"}], "=", "6"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dacNumbers", "[", "\"\<TDAC-1\>\"", "]"}], "=", "7"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.900001563802374*^9, 3.9000018080143137`*^9}, {
  3.90001457405017*^9, 3.9000145761126223`*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"ca5be524-a190-4f1c-894c-d5a3bc6c0c1f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"setDACuncalibrated", "[", 
   RowBox[{"dac_String", ",", "val_Integer"}], "]"}], ":=", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"dacCMD", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"dacNumbers", "[", "dac", "]"}], "*", "4096"}], "+", 
       RowBox[{"Clip", "[", 
        RowBox[{"val", ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "4095"}], "}"}]}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"writeAdr", "[", "\"\<DAC_DATA\>\"", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"rawXdata", "[", "dacCMD", "]"}], ";"}]}], "\[IndentingNewLine]",
    "]"}]}]], "Input",
 CellChangeTimes->{{3.900001894615492*^9, 3.900001982932764*^9}, {
  3.9000144307610607`*^9, 3.900014455863233*^9}, {3.900014499786888*^9, 
  3.900014535583637*^9}, {3.900014586052752*^9, 3.9000146237009993`*^9}, {
  3.900014680799046*^9, 3.900014744146305*^9}, {3.900014778543171*^9, 
  3.900014825517174*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"0733ecf7-aa55-4558-a27f-7dd108ac073d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"readRegister", "[", "reg_String", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"readAdr", "[", "reg", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"rawXdata", "[", "0", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"cachedRegister", "[", "reg", "]"}], "=", "lastDataIn"}]}], 
   "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{{3.9000938917399817`*^9, 3.900094075059462*^9}, {
  3.900094181114254*^9, 3.900094193443576*^9}, {3.900096158999338*^9, 
  3.9000962819023247`*^9}, {3.900096693735779*^9, 3.90009670930967*^9}, {
  3.900097111832602*^9, 3.900097120135268*^9}, {3.900153392366848*^9, 
  3.9001534655584106`*^9}, {3.90015866432231*^9, 3.900158697564499*^9}, {
  3.900168092599765*^9, 3.900168110216613*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"4b282642-d34f-4d2c-bf54-72055709b5b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"signed16", "[", "n_Integer", "]"}], ":=", 
  RowBox[{
   RowBox[{"Mod", "[", 
    RowBox[{
     RowBox[{"n", "+", "32768"}], ",", "65536"}], "]"}], "-", 
   "32768"}]}]], "Input",
 CellChangeTimes->{{3.900159986072584*^9, 3.9001600427545137`*^9}},
 CellLabel->"In[57]:=",ExpressionUUID->"7b74eb15-cc08-4785-9e4f-c853a1a79dc4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"signed16", "[", "t_TextCell", "]"}], ":=", "t"}]], "Input",
 CellChangeTimes->{{3.90016147403679*^9, 3.900161498925796*^9}, {
  3.90016154220399*^9, 3.9001615640708513`*^9}, {3.900161635786524*^9, 
  3.900161658707596*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"fc2696b1-8fb8-4c85-8b02-8e4e2b877cbe"],

Cell["Abbrevs", "Text",
 CellChangeTimes->{{3.900063068115933*^9, 
  3.900063073233418*^9}},ExpressionUUID->"0f9366f6-3957-4407-94b8-\
df40164dfcb0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rc", "=", "rawCommand"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rxa", "=", "rawXadr"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rxd", "=", "rawXdata"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ra", "=", "readAdr"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wa", "=", "writeAdr"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sdu", "=", "setDACuncalibrated"}], ";"}]}], "Input",
 CellChangeTimes->{{3.900063091670439*^9, 3.9000631353399982`*^9}, 
   3.900063265089037*^9, {3.900063323043476*^9, 3.900063364212248*^9}, {
   3.900065223184977*^9, 3.9000652455870333`*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"17fac4b0-2c3f-4edb-a7f5-02d90d66972e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"enabled", "=", "False"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"enableButtonText", "[", "True", "]"}], "=", "\"\<Disable\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"enableButtonText", "[", "False", "]"}], "=", "\"\<Enable\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"toggleEnable", "[", "True", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"rawCommand", "[", "\"\<disable\>\"", "]"}], ";", 
    RowBox[{"enabled", "=", "False"}], ";"}], 
   ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"toggleEnable", "[", "False", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"rawCommand", "[", "\"\<enable\>\"", "]"}], ";", " ", 
    RowBox[{"enabled", "=", "True"}], ";"}], ")"}]}]}], "Input",
 CellChangeTimes->{{3.9000636966225567`*^9, 3.9000637224625883`*^9}, {
  3.900172138120105*^9, 3.900172165735671*^9}, {3.900172303784384*^9, 
  3.9001723236988783`*^9}},
 CellLabel->"In[82]:=",ExpressionUUID->"d6264541-1192-488b-9f08-cb4c32270c78"],

Cell[BoxData[
 RowBox[{
  RowBox[{"startGSE", "[", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.90017513058173*^9, 
  3.900175137786275*^9}},ExpressionUUID->"618de8d7-62ac-4d6d-a30d-\
cbdf6b0155d8"],

Cell[BoxData[
 RowBox[{"controlPanel", "=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateDocument", "[", "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"Column", "[", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Spacer", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", "10"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Button", "[", 
          RowBox[{
           RowBox[{"Dynamic", "[", 
            RowBox[{"enableButtonText", "[", "enabled", "]"}], "]"}], ",", 
           RowBox[{"toggleEnable", "[", "enabled", "]"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Spacer", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", "20"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"TextCell", "[", "\"\<FPGA Interface\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Row", "[", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"TextCell", "[", "\"\<Read address: \>\"", "]"}], ",", 
            RowBox[{"Dynamic", "[", 
             RowBox[{"TextCell", "[", "shadowReadAddr", "]"}], "]"}], ",", 
            RowBox[{"Spacer", "[", "40", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"TextCell", "[", "\"\<Data in: \>\"", "]"}], ",", " ", 
            RowBox[{"Dynamic", "[", "lastDataIn", "]"}], ",", 
            RowBox[{"Spacer", "[", "40", "]"}], ",", 
            RowBox[{"TextCell", "[", "\"\<Write address: \>\"", "]"}], ",", 
            RowBox[{"Dynamic", "[", 
             RowBox[{"TextCell", "[", "shadowWriteAddr", "]"}], "]"}], ",", 
            RowBox[{"Spacer", "[", "40", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"TextCell", "[", "\"\<Data out: \>\"", "]"}], ",", " ", 
            RowBox[{"Dynamic", "[", "lastDataOut", "]"}], ",", 
            RowBox[{"Spacer", "[", "40", "]"}]}], "}"}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Spacer", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", "20"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Row", "[", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Column", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Row", "[", "\[IndentingNewLine]", 
                 RowBox[{"{", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"TextCell", "[", "\"\<Housekeeping  \>\"", "]"}], 
                   ",", 
                   RowBox[{"Button", "[", 
                    RowBox[{"\"\<Refresh\>\"", ",", 
                    RowBox[{"Scan", "[", 
                    RowBox[{"readRegister", ",", "HKchannels"}], "]"}], ",", 
                    RowBox[{"Method", "\[Rule]", "\"\<Queued\>\""}]}], 
                    "]"}]}], "\[IndentingNewLine]", "}"}], 
                 "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
                RowBox[{"Spacer", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "10"}], "}"}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"TableForm", "[", 
                 RowBox[{"Transpose", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"TextCell", "/@", "HKchannels"}], ",", 
                    RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"signed16", "[", 
                    RowBox[{"cachedRegister", "[", "#", "]"}], "]"}], "]"}], 
                    "&"}], ",", "HKchannels"}], "]"}]}], "}"}], "]"}], 
                 "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"BaselinePosition", "\[Rule]", "Top"}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Spacer", "[", "60", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Column", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Row", "[", "\[IndentingNewLine]", 
                 RowBox[{"{", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"TextCell", "[", "\"\<FPGA Registers  \>\"", "]"}],
                    ",", 
                   RowBox[{"Button", "[", 
                    RowBox[{"\"\<Refresh\>\"", ",", 
                    RowBox[{"Scan", "[", 
                    RowBox[{"readRegister", ",", "FPGAregs"}], "]"}], ",", 
                    RowBox[{"Method", "\[Rule]", "\"\<Queued\>\""}]}], 
                    "]"}]}], "\[IndentingNewLine]", "}"}], 
                 "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
                RowBox[{"Spacer", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "10"}], "}"}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"TableForm", "[", 
                 RowBox[{"Transpose", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"TextCell", "/@", "FPGAregs"}], ",", 
                    RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"signed16", "[", 
                    RowBox[{"cachedRegister", "[", "#", "]"}], "]"}], "]"}], 
                    "&"}], ",", "FPGAregs"}], "]"}]}], "}"}], "]"}], "]"}]}], 
               "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"BaselinePosition", "\[Rule]", "Top"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}], 
       "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}], 
     "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"shadowReadAddr", "=", " ", 
     RowBox[{"TextCell", "[", "\"\<N/A\>\"", "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"shadowWriteAddr", "=", " ", 
     RowBox[{"TextCell", "[", "\"\<N/A\>\"", "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"lastDataIn", " ", "=", " ", 
     RowBox[{"TextCell", "[", "\"\<N/A\>\"", "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"lastDataOut", " ", "=", " ", 
     RowBox[{"TextCell", "[", "\"\<N/A\>\"", "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Scan", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"cachedRegister", "[", "#", "]"}], "=", 
         RowBox[{"TextCell", "[", "\"\<N/A\>\"", "]"}]}], ")"}], "&"}], ",", 
      RowBox[{"Join", "[", 
       RowBox[{"HKchannels", ",", "FPGAregs"}], "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{{3.900073318995798*^9, 3.900073325500063*^9}, {
   3.9000733571374483`*^9, 3.900073364169607*^9}, {3.90007340369657*^9, 
   3.900073459511005*^9}, {3.9000735124065*^9, 3.900073655360935*^9}, {
   3.900073871461899*^9, 3.9000739693229322`*^9}, {3.900074039107142*^9, 
   3.900074087814918*^9}, {3.900074129525323*^9, 3.9000741364734373`*^9}, {
   3.90007417313102*^9, 3.900074174085599*^9}, {3.900074221426915*^9, 
   3.9000742465397177`*^9}, {3.900074289740406*^9, 3.900074298582326*^9}, {
   3.900074337583392*^9, 3.900074339139*^9}, {3.900074630670041*^9, 
   3.900074674344327*^9}, {3.900074717615259*^9, 3.900074785855288*^9}, {
   3.9000753739040403`*^9, 3.900075388983945*^9}, {3.900075428261125*^9, 
   3.900075535775919*^9}, {3.900083929645516*^9, 3.900084124534041*^9}, {
   3.900093135199678*^9, 3.9000932308473682`*^9}, 3.90009354635038*^9, {
   3.900093578728039*^9, 3.900093692123013*^9}, {3.900153084982274*^9, 
   3.900153089717688*^9}, {3.900154920559599*^9, 3.900154954987475*^9}, {
   3.900155148351234*^9, 3.900155177929509*^9}, {3.900155219417707*^9, 
   3.900155232783732*^9}, {3.9001594971194963`*^9, 3.900159540168065*^9}, {
   3.900159589989903*^9, 3.900159705154482*^9}, {3.900160077261427*^9, 
   3.90016010528694*^9}, {3.900160339034446*^9, 3.900160492816565*^9}, {
   3.900160542704537*^9, 3.900160645509026*^9}, {3.900160678595674*^9, 
   3.900160706335284*^9}, {3.900160743439816*^9, 3.900160759001565*^9}, {
   3.900160802357761*^9, 3.900160818631702*^9}, {3.900160962549486*^9, 
   3.900160996752632*^9}, {3.900161029070651*^9, 3.9001610346458483`*^9}, {
   3.900161175185268*^9, 3.900161299913167*^9}, {3.900161971790143*^9, 
   3.900162017508669*^9}, 3.900162812848805*^9, {3.900163297264592*^9, 
   3.900163357439227*^9}, {3.900163886664134*^9, 3.900163893390128*^9}, {
   3.9001646596799593`*^9, 3.9001646767401323`*^9}, {3.900164728490107*^9, 
   3.900164741916316*^9}, {3.900167751436005*^9, 3.9001678501772203`*^9}, 
   3.900168194476676*^9, {3.900170429984761*^9, 3.900170442561528*^9}, {
   3.90017058260504*^9, 3.9001705894270573`*^9}, 3.900170663286044*^9, {
   3.900172207743166*^9, 3.900172292736314*^9}},
 CellLabel->"In[87]:=",ExpressionUUID->"3901ba9f-82e7-46b6-9e88-a6e0596b97d5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"log", "=", 
   RowBox[{"CreateDocument", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"WindowTitle", "\[Rule]", "\"\<Log\>\""}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.900084140948997*^9, 3.900084203104353*^9}, 
   3.900084376918895*^9},
 CellLabel->"In[67]:=",ExpressionUUID->"170b3ef6-57f6-4afd-80d5-110354b9b32b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"toLog", "[", "s_String", "]"}], ":=", 
   RowBox[{"NotebookWrite", "[", 
    RowBox[{"log", ",", 
     RowBox[{"Cell", "[", 
      RowBox[{"s", ",", "\"\<Output\>\""}], "]"}]}], "]"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.900084263647849*^9, 3.9000843259191008`*^9}, {
   3.900084371348153*^9, 3.9000843930476313`*^9}, 3.900084662964633*^9},
 CellLabel->"In[68]:=",ExpressionUUID->"10fb33e8-4e8f-4e91-85ca-40e2ec857fc6"]
},
WindowSize->{798, 986},
WindowMargins->{{395, Automatic}, {-38, Automatic}},
FrontEndVersion->"12.2 for Linux ARM (32-bit) (March 25, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"2c0b814e-1d2a-4f16-9227-9e9d94769e90"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 757, 18, 141, "Input",ExpressionUUID->"e4b641ad-6640-4600-95ff-470fc8616eec"],
Cell[1318, 40, 4750, 134, 691, "Input",ExpressionUUID->"e9f1608d-78bb-41c4-8ab6-01451057e5f5"],
Cell[6071, 176, 966, 30, 75, "Input",ExpressionUUID->"db9d2bf5-dafd-4e2c-b724-4c4cac234a54"],
Cell[7040, 208, 450, 10, 30, "Input",ExpressionUUID->"27f605d0-a74c-4b0e-9f16-3c6d6642680b"],
Cell[7493, 220, 517, 11, 30, "Input",ExpressionUUID->"92843710-6778-4385-83ad-9e22a8d6cbb6"],
Cell[8013, 233, 898, 17, 119, "Input",ExpressionUUID->"4bd36f92-1ea9-41c5-8e23-cc7d5d06af98"],
Cell[8914, 252, 910, 20, 119, "Input",ExpressionUUID->"ec58ca09-b59f-4f18-9942-ba2132239018"],
Cell[9827, 274, 754, 15, 97, "Input",ExpressionUUID->"ded5d7ff-0ebf-459e-ac76-79bb6fab9e5b"],
Cell[10584, 291, 659, 13, 75, "Input",ExpressionUUID->"7ef29023-2022-4af5-8fbe-e73bca52064f"],
Cell[11246, 306, 657, 13, 75, "Input",ExpressionUUID->"e665a488-f3ac-4df9-bda9-3bfc1e3b9f25"],
Cell[11906, 321, 683, 15, 53, "Input",ExpressionUUID->"fd216a1a-e174-4db8-a7ab-216f0847904e"],
Cell[12592, 338, 289, 7, 35, "Text",ExpressionUUID->"1e40a1cf-a670-471f-8511-e7a21682c41e"],
Cell[12884, 347, 549, 13, 53, "Input",ExpressionUUID->"2e630c41-c96b-48d4-9503-3ef8d2e5bdec"],
Cell[13436, 362, 1274, 38, 207, "Input",ExpressionUUID->"ca5be524-a190-4f1c-894c-d5a3bc6c0c1f"],
Cell[14713, 402, 1107, 26, 119, "Input",ExpressionUUID->"0733ecf7-aa55-4558-a27f-7dd108ac073d"],
Cell[15823, 430, 892, 16, 119, "Input",ExpressionUUID->"4b282642-d34f-4d2c-bf54-72055709b5b6"],
Cell[16718, 448, 361, 9, 30, "Input",ExpressionUUID->"7b74eb15-cc08-4785-9e4f-c853a1a79dc4"],
Cell[17082, 459, 337, 6, 30, "Input",ExpressionUUID->"fc2696b1-8fb8-4c85-8b02-8e4e2b877cbe"],
Cell[17422, 467, 149, 3, 35, "Text",ExpressionUUID->"0f9366f6-3957-4407-94b8-df40164dfcb0"],
Cell[17574, 472, 741, 16, 141, "Input",ExpressionUUID->"17fac4b0-2c3f-4edb-a7f5-02d90d66972e"],
Cell[18318, 490, 1032, 27, 119, "Input",ExpressionUUID->"d6264541-1192-488b-9f08-cb4c32270c78"],
Cell[19353, 519, 199, 5, 30, "Input",ExpressionUUID->"618de8d7-62ac-4d6d-a30d-cbdf6b0155d8"],
Cell[19555, 526, 9322, 174, 1329, "Input",ExpressionUUID->"3901ba9f-82e7-46b6-9e88-a6e0596b97d5"],
Cell[28880, 702, 383, 10, 30, "Input",ExpressionUUID->"170b3ef6-57f6-4afd-80d5-110354b9b32b"],
Cell[29266, 714, 473, 11, 30, "Input",ExpressionUUID->"10fb33e8-4e8f-4e91-85ca-40e2ec857fc6"]
}
]
*)

